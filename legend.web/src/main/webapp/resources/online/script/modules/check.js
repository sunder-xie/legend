/*-- 淘汽云修 2016-03-09 04:48:56 --*/
define(function(require,exports,module){var a=require("./dialog"),b=require("./ajax"),c="input[v_type],select[v_type],textarea[v_type]",d='<div class="qxy_err_msg"><div class="qxy_err_msg_inner"><p>内容不能为空</p><span></span><i></i></div></div>',e=function(b,c){var d=b.val(),e=JSON.parse(b.attr("v_type")),f=b.attr("label")||"",h=b.siblings(".qxy_err_msg"),i=!0;return e&&""!=e?(f=f.replace(/\s|[:：]/gm,""),$.each(g,function(j,k){var l=void 0,m=e[j];if(!e[j])return!0;if("type"==j)l=g[j][m](d);else if("vurl"==j){var n=b.attr("v_name");l=g[j](d,e[j],n,b,f,h)}else l=g[j](d,e[j]);if(l&&l.result)h.hide(),i=!0;else if(void 0!=l)return"tips"==c?($("p",h).html(f+l.msg),h.show()):"alert"==c&&(a.info(f+l.msg,3,2),b.focus()),i=!1,!1}),i):!0},f=function(){$(c).each(function(){$(this).parent().css("position","relative"),$(this).siblings(".qxy_err_msg").remove(),$(this).before(d)}),$("div[dynamic_name]").each(function(){var a=$(this).attr("dynamic_name");$(c,$(this)).each(function(){$(this).attr("dynamic_name",a)})})};module.exports={init:function(a){f()},check:function(a){var b=!0;return $(c,a||"body").each(function(){if($(this).trigger("blur"),void 0!=$(this).attr("dynamic_name")){var a=$(this).parents("[dynamic_name]"),d=$(c,a);if(a.next("[dynamic_name]").size()>0)d.each(function(){e($(this),"tips")});else{var f=!1;d.each(function(){""!=$(this).val()&&$(this).is(":visible")&&(f=!0)}),f?d.each(function(){e($(this),"tips")}):d.each(function(){$(this).siblings(".qxy_err_msg").hide()})}}else b=e($(this),"tips")}),$(".qxy_err_msg:visible",a||"body").size()>0?!1:!0},check2:function(a){var b=!0;return $(c,a||"body").each(function(){return $(this).trigger("blur"),b=e($(this),"alert"),b?void 0:!1}),b},bind:function(a){$(a||"body").on("blur",c,function(){if(void 0!=$(this).attr("dynamic_name")){var a=$(this).parents("[dynamic_name]");if(a.next("[dynamic_name]").size()>0)e($(this),"tips");else{var b=$(c,a),d=!1;b.each(function(){""!=$(this).val()&&$(this).is(":visible")&&(d=!0)}),d?e($(this),"tips"):$(this).siblings(".qxy_err_msg").hide()}}else e($(this),"tips")})}};var g={required:function(a,b){var c=["","不能为空"];return b?""==a?{msg:c[1],result:!1}:{msg:c[0],result:!0}:void 0},maxLength:function(a,b){var c=["","字符串长度不能大于"+b];return a.length<=b?{msg:c[0],result:!0}:{msg:c[1],result:!1}},minLength:function(a,b){var c=["","字符串长度不能小于"+b];return a.length>=b?{msg:c[0],result:!0}:{msg:c[1],result:!1}},maxValue:function(a,b){var c=["","数字值不能大于"+b,"请输入数字"];return $.isNumeric(a)?Number(a)<=b?{msg:c[0],result:!0}:{msg:c[1],result:!1}:{msg:c[2],result:!1}},minValue:function(a,b){var c=["","数字值不能大于"+b,"请输入数字"];return $.isNumeric(a)?Number(a)<=b?{msg:c[0],result:!0}:{msg:c[1],result:!1}:{msg:c[2],result:!1}},vurl:function(a,c,d,e,f,g){var h=["","已存在"],i={};i[d]=a;var j=$.Deferred(),k=function(a){return b.post({url:BASE_PATH+c,loadShow:!1,async:!1,data:i,success:function(b){a.resolve(b)}}),a};k(j).done(function(a){1!=a.success?($("p",g).html(a.errorMsg),g.show()):0==a.data&&($("p",g).html(f+h[1]),g.show())})},type:{number:function(a){var b=["","数值不能小于0","请输入数字"];return""==$.trim(a)?{msg:b[0],result:!0}:$.isNumeric(a)?0>a?{msg:b[1],result:!1}:{msg:b[0],result:!0}:{msg:b[2],result:!1}},email:function(a){var b=/\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/,c=["","格式不正确"];return""==$.trim(a)?{msg:c[0],result:!0}:b.test(a)?{msg:c[0],result:!0}:{msg:c[1],result:!1}},zip:function(a){var b=/^[1-9]\d{5}$/,c=["","格式不正确"];return""==$.trim(a)?{msg:c[0],result:!0}:b.test(a)?{msg:c[0],result:!0}:{msg:c[1],result:!1}},tel:function(a){var b=/^[0-9]\d{9,11}$/,c=["","格式不正确"];return""==$.trim(a)?{msg:c[0],result:!0}:b.test(a)?{msg:c[0],result:!0}:{msg:c[1],result:!1}},phone:function(a){var b=/^1[3|4|5|7|8][0-9]\d{8}$/,c=["","格式不正确"];return""==$.trim(a)?{msg:c[0],result:!0}:b.test(a)?{msg:c[0],result:!0}:{msg:c[1],result:!1}},qq:function(a){var b=/^[1-9]\d{5,10}$/,c=["","格式不正确"];return""==$.trim(a)?{msg:c[0],result:!0}:b.test(a)?{msg:c[0],result:!0}:{msg:c[1],result:!1}},ooxx:function(){},ooxx:function(){}}}});