/*-- 淘汽云修 2016-03-09 04:48:56 --*/
define(function(requrie,exports,module){module.exports={query:function(a,b){var c=a.match(/^(select)\s+([a-z0-9_\,\.\s\*]+)\s+from\s+([a-z0-9_\.]+)(?: where\s+\((.+)\))?\s*(?:order\sby\s+([a-z0-9_\,]+))?\s*(asc|desc|ascnum|descnum)?\s*(?:limit\s+([0-9_\,]+))?/i),d={fields:c[2].replace(" ","").split(","),from:c[3].replace(" ",""),where:void 0==c[4]?"true":c[4],orderby:void 0==c[5]?[]:c[5].replace(" ","").split(","),order:void 0==c[6]?"asc":c[6],limit:void 0==c[7]?[]:c[7].replace(" ","").split(",")};return this.parse(b,d)},parse:function(a,b){var c={fields:["*"],from:"json",where:"",orderby:[],order:"asc",limit:[]};for(i in b)c[i]=b[i];var d=[];return d=this.returnFilter(a,c),d=this.returnOrderBy(d,c.orderby,c.order),d=this.returnLimit(d,c.limit)},returnFilter:function(json,jsonsql_o){var jsonsql_scope=eval(jsonsql_o.from),jsonsql_result=[],jsonsql_rc=0;""==jsonsql_o.where&&(jsonsql_o.where="true");for(var jsonsql_i in jsonsql_scope)with(jsonsql_scope[jsonsql_i])eval(jsonsql_o.where)&&(jsonsql_result[jsonsql_rc++]=this.returnFields(jsonsql_scope[jsonsql_i],jsonsql_o.fields));return jsonsql_result},returnFields:function(a,b){if(0==b.length&&(b=["*"]),"*"==b[0])return a;var c={};for(var d in b)c[b[d]]=a[b[d]];return c},returnOrderBy:function(result,orderby,order){return 0==orderby.length?result:(result.sort(function(a,b){switch(order.toLowerCase()){case"desc":return eval("a."+orderby[0]+" < b."+orderby[0])?1:-1;case"asc":return eval("a."+orderby[0]+" > b."+orderby[0])?1:-1;case"descnum":return eval("a."+orderby[0]+" - b."+orderby[0]);case"ascnum":return eval("b."+orderby[0]+" - a."+orderby[0])}}),result)},returnLimit:function(a,b){switch(b.length){case 0:return a;case 1:return a.splice(0,b[0]);case 2:return a.splice(b[0]-1,b[1])}}}});